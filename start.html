<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style/style.css">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
</head>

<body>
    <canvas id="camera--sensor"></canvas>
    <video id="camera--view" autoplay playsinline></video>
    <img id="res" src="" alt="">
    <div id="capture">캡쳐하기</div>
    <div id="result"></div>
    <script>
        let constraints = {
            video: {
                facingMode: "environment",
                width: 300,
                height: 300
            },
            audio: false
        };
        const cameraView = document.querySelector("#camera--view");
        const cameraSensor = document.querySelector("#camera--sensor");
        var player = document.getElementById("camera--view");

        function cameraStart() {
            navigator.mediaDevices.getUserMedia(constraints)
                .then(function(stream) {
                    track = stream.getTracks()[0];
                    cameraView.srcObject = stream;

                })
                .catch(function(error) {
                    console.error("카메라에 문제가 있습니다.", error);
                })
        }


        // 페이지가 로드되면 함수 실행
        window.addEventListener("load", cameraStart, false);
        var captureButton = document.getElementById("capture");

        captureButton.addEventListener("click", async function() {
            const webcam = await tf.data.webcam(player, {
                resizeWidth: 300,
                resizeHeight: 300
            });
            net = await mobilenet.load();
            while (true) {

                const img = await webcam.capture();
                const result = await net.classify(img);
                innerText = `prediction: ${result[0].className}\n probability: ${result[0].probability}`;
                document.getElementById("result").innerText = innerText;
                img.dispose();
                await tf.nextFrame();
            }
        });
    </script>
</body>

</html>